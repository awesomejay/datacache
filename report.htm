<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>DataCache Report</title>
    <link href="" rel="stylesheet" type="text/css" />
</head>
<body>
 

    <script id="reportTemplate" type="text/x-jQuery-tmpl">
			<div id="status"></div> 
	        <div style="font-family: monospace;position: relative;">
            <span title="${url}"><a href="${url}">${id}</a></span>
			<span title="Error">${formatboolean(error)}</span>
			<span title="File size (bytes)">${dataLength}</span>
			<span title="File served from cache">${formatboolean(isFromCache)}</span>
			<span title="File found in cache">${formatboolean(foundInCache)}</span>
			<span title="Job time (ms)">${computetime(jobStartTime,jobFinishedTime)}</span>
			<span title="Cache check time (ms)">${computetime(cacheCheckStartTime,cacheCheckFinishedTime)}</span>
			<span title="Time to get first chunk of data (ms)">${computetime(jobStartTime,getFirstChunkTime)}</span>
			<span title="File processing time">${computetime(work2ResultStartTime,work2ResultFinishedTime)}</span>
			<span title="Write time (ms)">${computetime(writeStartTime,writeFinishedTime)}</span>
        </div>
    </script>
 
 	<style>
	 	.tooltip {
	 	   position: absolute;
		   z-index: 3;
		   padding: 2px;
		   border:1px solid;
		   background-color:yellow;
		}        
 	</style>
 	
 	<script type="text/javascript" src="asset/sprintf-0.7-beta1.js"></script>	
	<script type="text/javascript" src="http://code.jquery.com/jquery-1.8.3.js"></script>
	<script type="text/javascript" src="http://jquery-simpletip.googlecode.com/files/jquery.simpletip-1.3.1.min.js"></script>
    <script type="text/javascript" src="http://ajax.aspnetcdn.com/ajax/jquery.templates/beta1/jquery.tmpl.js"></script>
 	
    <script type="text/javascript">
		$(function() {
			//$('span').simpletip();
			//console.log($("#reportTemplate").text());
		})
    		function formatboolean(b) {
    			return b.toString().replace('false','f').replace('true','t')
    		}
    		function computetime(start,stop) {
    			if (start == 0 || stop == 0) {
    				return "&nbsp;&nbsp;	-";
    			}
    			start = new Date(start);
    			stop = new Date(stop);
    			time = stop-start;
    			time = sprintf("%4s",time.toString());
    			return time.replace(/ /g,'&nbsp;');
    		}

    		var urls = new Array();
    		
		var dc = "http://localhost:8000/sync";
		source = "ftp%3A%2F%2Fftp.sec.noaa.gov%2Fpub%2Flists%2Fxray%2F20121218_Gp_xr_5m.txt%0D%0A%0D%0Aftp%3A%2F%2Fftp.sec.noaa.gov%2Fpub%2Flists%2Fxray%2F20121219_Gp_xr_5m.txt%0A	";
		var url = dc + "?forceUpdate=false&source="+source+source+source+source+source+source+source;
		urls[0] = url;

		var dc = "http://datacache.org/dc/sync";
		source = "ftp%3A%2F%2Fftp.sec.noaa.gov%2Fpub%2Flists%2Fxray%2F20121218_Gp_xr_5m.txt%0D%0A%0D%0Aftp%3A%2F%2Fftp.sec.noaa.gov%2Fpub%2Flists%2Fxray%2F20121219_Gp_xr_5m.txt%0A	";
		var url = dc + "?forceUpdate=false&source="+source+source+source+source+source+source+source;
		urls[1] = url;

		report = [];
		
		tic = new Date();
		getreport(urls[0],0);
		getreport(urls[1],1);
		
		function getreport(url,i) {
			var template = $("#reportTemplate").html();
			status = template.replace('status','status-'+i);
			//console.log(template);
			$('body').append("<div id='status'></div>".replace('status','status-'+i));
			$('#status-'+i).html("Sending request to " + url.replace(/\?.*/,''));
			$.ajax({
	    			type: 'GET',
	    			async: true,
	    			url: url, 
	    			success: function (data) {
							toc = new Date();
							
			    				$('#status-'+i).append(".  Done: "+(toc-tic)+" ms.");
							var template = $("#reportTemplate").html();
			    				var report = $.tmpl(template,data);
			    				$('#status-'+i).append(report);
							$('span').hover(
									function () {
													$(this).children(".tooltip").remove();
													$(this).attr('tooltip',$(this).attr('title') + ($(this).attr('tooltip')||""));
													$(this).attr('title','');
													var str = $(this).attr("title") + ($(this).attr("tooltip")||"");
													$(this).append("<span class='tooltip'>"+str+"</span>");
													var offset = $(this).offset();
													$(this).children(".tooltip").offset({ top: offset.top-25, left: offset.left});
												},
									function () {												
													$(this).children(".tooltip").css('display','none');});
	    			},
	    			error: function () {    						
							$('#status'+i).html("AJAX GET request to DataCache failed <a href='" + url + "''>Request</a>");
	    					}
	    		});
		}

  
    </script>
 
</body>
</html>