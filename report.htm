<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>DataCache Report</title>
    <link href="" rel="stylesheet" type="text/css" />
</head>
<body>
 
	<div id="status"></div> 
    <div id="pageContent">
        <h4>Report</h4>
        <div id="reportContainer"></div>
    </div>

    <script id="reportTemplate" type="text/x-jQuery-tmpl">
        <div style="position: relative;">
            <a href="${url}">${url}</a>
			<span title="Error">${formatboolean(error)}&nbsp;</span>
			<span title="File download error">${dataLength}&nbsp;</span>
			<span title="File will be served from cache">${formatboolean(isFromCache)}&nbsp;</span>
			<span title="File found in cache">${formatboolean(foundInCache)}&nbsp;</span>
			<span title="Job time (ms)">${computetime(jobStartTime,jobFinishedTime)}&nbsp;</span>
			<span title="Cache check time (ms)">${computetime(cacheCheckStartTime,cacheCheckFinishedTime)}&nbsp;</span>
			<span title="Time to get first chunk of data (ms)">${computetime(jobStartTime,getFirstChunkTime)}&nbsp;</span>
			<span title="File processing time">${computetime(work2ResultStartTime,work2ResultFinishedTime)}&nbsp;</span>
			<span title="Write time (ms)">${computetime(writeStartTime,writeFinishedTime)}&nbsp;</span>
        </div>
    </script>
 
 	<style>
	 	.tooltip {
	 	   position: absolute;
		   top: -1em;
		   left: 0;
		   z-index: 3;
		   border:1px solid;
		   background-color:yellow;
		}        
 	</style>
 	<script type="text/javascript" src="asset/sprintf-0.7-beta1.js"></script>	
	<script type="text/javascript" src="http://code.jquery.com/jquery-1.8.3.js"></script>
	<script type="text/javascript" src="http://jquery-simpletip.googlecode.com/files/jquery.simpletip-1.3.1.min.js"></script>
    <script type="text/javascript" src="http://ajax.aspnetcdn.com/ajax/jquery.templates/beta1/jquery.tmpl.js"></script>
 	
    <script type="text/javascript">
		$(function() {
			//$('span').simpletip();
		})
    		function formatboolean(b) {
    			return b.toString().replace('false','f').replace('true','t')
    		}
    		function computetime(start,stop) {
    			if (start == 0 || stop == 0) {
    				return "-";
    			}
    			start = new Date(start);
    			stop = new Date(stop);
    			time = stop-start;
    			time = sprintf("%4s",time.toString());
    			return time;
    		}
		var dc = "http://localhost:8000/sync";
		var dc = "http://datacache.org/dc/sync";
		var url = dc + "?forceUpdate=true&source=http://datacache.org/dc/demo/file1.txt%0Ahttp://datacache.org/dc/demo/file2.txt";
    		report = [];
    		$.ajax({
    			type: 'GET',
    			async: true,
    			url: url, 
    			success: function (data) {
    						$('#status').html("Fetching results from DataCache using <a href='" + url + "''>Request</a>.");
    			        		$("#reportTemplate").tmpl(data).appendTo("#reportContainer");
						$('#status').append(" Done.");
						$('span').hover(
								function () {$(this).children(".tooltip").remove();$(this).append("<span class='tooltip'>"+$(this).attr("title")+($(this).attr("tooltip")||"")+"</span>")},
								function () {$(this).attr('tooltip',$(this).attr('title')+($(this).attr('tooltip')||""));$(this).children(".tooltip").css('display','none');$(this).attr('title','')});
    			},
    			error: function () {    						
						$('#status').html("AJAX GET request to DataCache failed <a href='" + url + "''>Request</a>");
    					}
    		});

  
    </script>
 
</body>
</html>